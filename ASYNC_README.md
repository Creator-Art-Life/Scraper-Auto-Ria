# –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è AutoRia Scraper

## –û–±–∑–æ—Ä

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é —Å–∫—Ä–∞–ø–µ—Ä–∞ –¥–ª—è auto.ria.com, –∫–æ—Ç–æ—Ä–∞—è –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –±–æ–ª–µ–µ –≤—ã—Å–æ–∫—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–µ–π.

## –ö–ª—é—á–µ–≤—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### üöÄ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞**: –î–æ 20 –æ–±—ä—è–≤–ª–µ–Ω–∏–π –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ HTTP-–∑–∞–ø—Ä–æ—Å—ã**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `aiohttp` –≤–º–µ—Å—Ç–æ `requests`
- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ë–î**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `asyncpg` –≤–º–µ—Å—Ç–æ `psycopg2`
- **–ü–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞**: –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏–π –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
- **–ö–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–≥—Ä—É–∑–∫–∏**: –°–µ–º–∞—Ñ–æ—Ä—ã –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

### üìÑ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Å—Ç—Ä–∞–Ω–∏—Ü
- **–û–±—ã—á–Ω—ã–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è**: –ü–∞—Ä—Å–∏–Ω–≥ –±/—É –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π
- **–ù–æ–≤—ã–µ –∞–≤—Ç–æ–º–æ–±–∏–ª–∏ (newauto)**: –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –Ω–æ–≤—ã—Ö –∞–≤—Ç–æ –æ—Ç –¥–∏–ª–µ—Ä–æ–≤
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ**: –¢–∏–ø —Å—Ç—Ä–∞–Ω–∏—Ü—ã –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–æ URL

### üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º–æ—Å—Ç—å
- **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è**: –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `.env`
- **–ì–∏–±–∫–∏–µ –ª–∏–º–∏—Ç—ã**: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ–º–∞—Ñ–æ—Ä–æ–≤, —Ä–∞–∑–º–µ—Ä–æ–≤ –ø–∞–∫–µ—Ç–æ–≤, —Ç–∞–π–º–∞—É—Ç–æ–≤
- **–ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å**: –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ç–æ–Ω–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥ —Ä–∞–∑–Ω—ã–µ –Ω–∞–≥—Ä—É–∑–∫–∏

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

1. **scraper_core.py** - –Ø–¥—Ä–æ —Å–∫—Ä–∞–ø–µ—Ä–∞
   - `fetch_html_with_aiohttp()` - –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ HTML
   - `parse_ad_page()` - –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –ø–∞—Ä—Å–µ—Ä —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º —Ç–∏–ø–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
   - `parse_newauto_page()` - –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–∞—Ä—Å–µ—Ä –¥–ª—è –Ω–æ–≤—ã—Ö –∞–≤—Ç–æ
   - `parse_regular_ad_page()` - –ü–∞—Ä—Å–µ—Ä –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π
   - `process_ad_batch()` - –ü–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å —Å–µ–º–∞—Ñ–æ—Ä–∞–º–∏
   - `collect_ad_urls_from_page()` - –°–±–æ—Ä —Å—Å—ã–ª–æ–∫ (–≤–∫–ª—é—á–∞—è newauto)

2. **db_operations.py** - –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ë–î
   - –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–º–µ—é—Ç `_async` –≤–µ—Ä—Å–∏–∏
   - –ü–∞–∫–µ—Ç–Ω—ã–µ –≤—Å—Ç–∞–≤–∫–∏ –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
   - –ü—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

3. **main.py** - –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞
   - `perform_scraping_job_async()` - –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å —Å–∫—Ä–∞–ø–∏–Ω–≥–∞
   - `save_batch_to_db()` - –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–∞–∫–µ—Ç–æ–≤
   - –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —ç–º–æ–¥–∑–∏

## –¢–∏–ø—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü

### 1. –û–±—ã—á–Ω—ã–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è (–±/—É –∞–≤—Ç–æ)
**URL —Ñ–æ—Ä–º–∞—Ç**: `https://auto.ria.com/uk/auto-brand-model-id.html`

**–ò–∑–≤–ª–µ–∫–∞–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ**:
- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –æ–±—ä—è–≤–ª–µ–Ω–∏—è
- –¶–µ–Ω–∞ –≤ USD
- –ü—Ä–æ–±–µ–≥ (–≤ –∫–º)
- –ò–º—è –ø—Ä–æ–¥–∞–≤—Ü–∞
- –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (—á–µ—Ä–µ–∑ API)
- URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –ù–æ–º–µ—Ä –∞–≤—Ç–æ–º–æ–±–∏–ª—è
- VIN –∫–æ–¥

### 2. –ù–æ–≤—ã–µ –∞–≤—Ç–æ–º–æ–±–∏–ª–∏ (newauto)
**URL —Ñ–æ—Ä–º–∞—Ç**: `https://auto.ria.com/uk/newauto/auto-brand-model-id.html`

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞**:
- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏–∑ `h1.auto-head_title`
- –¶–µ–Ω–∞ –∏–∑ `div.auto-price` (–ø–æ–∏—Å–∫ –ø–æ –ø–∞—Ç—Ç–µ—Ä–Ω—É "—á–∏—Å–ª–æ $")
- –ü—Ä–æ–±–µ–≥ –∏–∑ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –∞–≤—Ç–æ—Å–∞–ª–æ–Ω–∞ –∏–ª–∏ 0 –¥–ª—è –Ω–æ–≤—ã—Ö –∞–≤—Ç–æ
- –ò–º—è –∞–≤—Ç–æ—Å–∞–ª–æ–Ω–∞ –∏–∑ `div.seller_info_name`
- –¢–µ–ª–µ—Ñ–æ–Ω –∏–∑ –∫–Ω–æ–ø–∫–∏ `span.conversion_phone_newcars`
- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ –≥–∞–ª–µ—Ä–µ–∏ `div.image-gallery-slide`
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–æ—Ç–æ –∏–∑ –ª–µ–π–±–ª–∞ `label.panoram-tab-item`
- VIN –∏–∑ —Å–µ–∫—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ `section.vin_checked`
- –ù–æ–º–µ—Ä –∞–≤—Ç–æ–º–æ–±–∏–ª—è –æ–±—ã—á–Ω–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç (null)

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```env
# –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
SEMAPHORE_LIMIT=2          # –ú–∞–∫—Å–∏–º—É–º –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
BATCH_SIZE=5               # –†–∞–∑–º–µ—Ä –ø–∞–∫–µ—Ç–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏–π
BATCH_DELAY=2.0            # –ü–∞—É–∑–∞ –º–µ–∂–¥—É –ø–∞–∫–µ—Ç–∞–º–∏ (—Å–µ–∫)
PAGE_DELAY=3.0             # –ü–∞—É–∑–∞ –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏ (—Å–µ–∫)

# HTTP —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
CONNECTION_LIMIT=50        # –û–±—â–∏–π –ª–∏–º–∏—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
CONNECTION_LIMIT_PER_HOST=20  # –õ–∏–º–∏—Ç –Ω–∞ —Ö–æ—Å—Ç
CONNECTION_TIMEOUT=30      # –û–±—â–∏–π —Ç–∞–π–º–∞—É—Ç (—Å–µ–∫)
CONNECT_TIMEOUT=10         # –¢–∞–π–º–∞—É—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (—Å–µ–∫)
```

## –û–∂–∏–¥–∞–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –ü–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–µ–π:
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏–π**: 3-5x –±—ã—Å—Ç—Ä–µ–µ –±–ª–∞–≥–æ–¥–∞—Ä—è –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–∞—Ü–∏–∏
- **–û–ø–µ—Ä–∞—Ü–∏–∏ —Å –ë–î**: 2-3x –±—ã—Å—Ç—Ä–µ–µ —á–µ—Ä–µ–∑ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏ –ø–∞–∫–µ—Ç–Ω—ã–µ –≤—Å—Ç–∞–≤–∫–∏
- **–û–±—â–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: 4-7x —É–ª—É—á—à–µ–Ω–∏–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫

### –ü—Ä–∏–º–µ—Ä–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:
- **–°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è**: ~10-15 –æ–±—ä—è–≤–ª–µ–Ω–∏–π/–º–∏–Ω—É—Ç—É
- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è**: ~50-100 –æ–±—ä—è–≤–ª–µ–Ω–∏–π/–º–∏–Ω—É—Ç—É (–ø—Ä–∏ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö)

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–∫—Ä–∞–ø–µ—Ä–∞
```bash
python scraper/main.py
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä—Å–∏–Ω–≥–∞ newauto
```bash
python test_newauto_parsing.py
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
```bash
python test_async.py
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –≤–∫–ª—é—á–∞–µ—Ç —É–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
- üöÄ –ù–∞—á–∞–ª–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–∞–∫–µ—Ç–æ–≤
- üîÑ –ü—Ä–æ–≥—Ä–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π
- üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—é –ø–∞–∫–µ—Ç–æ–≤
- üíæ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –≤ –ë–î
- ‚è≠Ô∏è –ü—Ä–æ–ø—É—Å–∫ —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π
- ‚ùå –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

## –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≤–º–µ—Å—Ç–∏–º–∞ —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å—Ö–µ–º–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ —Ç–∞–±–ª–∏—Ü.

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ

### –î–ª—è –≤—ã—Å–æ–∫–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:
```env
SEMAPHORE_LIMIT=10
BATCH_SIZE=20
BATCH_DELAY=1.0
PAGE_DELAY=2.0
```

### –î–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã:
```env
SEMAPHORE_LIMIT=2
BATCH_SIZE=5
BATCH_DELAY=2.0
PAGE_DELAY=3.0
```

### –î–ª—è –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä:
```env
SEMAPHORE_LIMIT=1
BATCH_SIZE=3
BATCH_DELAY=5.0
PAGE_DELAY=10.0
``` 